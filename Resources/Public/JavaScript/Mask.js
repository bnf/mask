define(["./components/NestedDraggable"],(function(e){"use strict";define(["TYPO3/CMS/Mask/Contrib/vue","TYPO3/CMS/Mask/Contrib/vuedraggable","TYPO3/CMS/Mask/Components/FormField","TYPO3/CMS/Mask/Components/FieldKey","TYPO3/CMS/Mask/Components/ElementKey","TYPO3/CMS/Mask/Components/SplashScreen","TYPO3/CMS/Mask/Components/ButtonBar","TYPO3/CMS/Mask/Components/FontIconPicker","TYPO3/CMS/Mask/Components/FieldGroup","TYPO3/CMS/Mask/Components/ElementColorPicker","TYPO3/CMS/Core/Ajax/AjaxRequest","TYPO3/CMS/Backend/Icons","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Severity","TYPO3/CMS/Backend/Notification","TYPO3/CMS/Backend/MultiStepWizard","TYPO3/CMS/Backend/ActionButton/DeferredAction"],(function(t,s,i,l,n,a,r,o,h,d,c,u,m,g,f,p,y){document.getElementById("mask")&&new t({el:"#mask",components:{draggable:s,nestedDraggable:e,formField:i,elementKey:n,fieldKey:l,splashscreen:a,buttonBar:r,fontIconPicker:o,fieldGroup:h,elementColorPicker:d},data:function(){return{version:"",mode:"list",type:"",sidebar:"fields",searchString:"",groups:[],elements:[],element:{},backendLayouts:[],fieldTypes:[],tcaFields:{},onlineMedia:[],linkHandlerList:[],tabs:{},fields:[],language:[],icons:{},faIcons:{},availableTca:{},multiUseElements:{},optionalExtensionStatus:{},migrationsDone:!1,fieldErrors:{elementKeyAvailable:!0,elementKey:!1,elementLabel:!1,emptyKeyFields:[],emptyTabLabels:[],emptyGroupAllowedFields:[],emptyRadioItems:[],existingFieldKeyFields:[]},global:{typo3Version:10,activeField:{},clonedField:{},richtextConfiguration:{},currentTab:"general",ctypes:{},sctructuralFields:["linebreak","palette","tab"],nonShareableFields:["inline","content","palette","linebreak","tab"],maskPrefix:"tx_mask_",deletedFields:[]},loaded:!1,missingFilesOrFolders:{missing:!1,missingFolders:{},missingTemplates:{}},setupConfiguration:{extension:"",loader:"json",error:""},saving:!1,ticks:0}},mounted:function(){this.init()},watch:{element:{handler(){this.validate()},deep:!0},fields:{handler(){this.validate()},deep:!0},"global.activeField.fields":function(){this.validate()},"element.key":function(){if("new"!==this.mode)return;const e=this.checkAllowedCharacters(this.element.key);this.element.key===e?new c(TYPO3.settings.ajaxUrls.mask_check_element_key).withQueryArguments({key:this.element.key}).get().then((async e=>{const t=await e.resolve();this.fieldErrors.elementKeyAvailable=t.isAvailable})):this.element.key=e}},methods:{init(){const e=new c(TYPO3.settings.ajaxUrls.mask_setup_complete).get().then((async e=>await e.resolve()));Promise.resolve(e).then((e=>{const t=[];if(t.push(new c(TYPO3.settings.ajaxUrls.mask_versions).get().then((async e=>{const t=await e.resolve();this.version=t.mask,this.global.typo3Version=t.typo3}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_language).get().then((async e=>{this.language=await e.resolve()}))),!e.setupComplete)return this.mode="setup",""!==e.loader&&(this.setupConfiguration.loader=e.loader),void Promise.all(t).then((()=>{this.loaded=!0}));this.mode="list",t.push(new c(TYPO3.settings.ajaxUrls.mask_tca_fields).get().then((async e=>{this.tcaFields=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_online_media).get().then((async e=>{this.onlineMedia=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_link_handler).get().then((async e=>{this.linkHandlerList=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_tabs).get().then((async e=>{this.tabs=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_richtext_configuration).get().then((async e=>{this.global.richtextConfiguration=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_ctypes).get().then((async e=>{const t=await e.resolve();this.global.ctypes=t.ctypes}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_field_groups).get().then((async e=>{const t=await e.resolve();this.groups=t.groups}))),t.push(this.loadElements()),t.push(this.loadTables()),t.push(new c(TYPO3.settings.ajaxUrls.mask_backend_layouts).get().then((async e=>{const t=await e.resolve();this.backendLayouts=t.backendLayouts}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_icons).get().then((async e=>{this.faIcons=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_missing).get().then((async e=>{this.missingFilesOrFolders=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_optional_extension_status).get().then((async e=>{this.optionalExtensionStatus=await e.resolve()}))),t.push(new c(TYPO3.settings.ajaxUrls.mask_migrations_done).get().then((async e=>{const t=await e.resolve();this.migrationsDone=t.migrationsDone}))),t.push(u.getIcon("actions-edit-delete",u.sizes.small).then((e=>{this.icons.delete=e}))),t.push(u.getIcon("actions-move-move",u.sizes.small).then((e=>{this.icons.move=e}))),t.push(u.getIcon("actions-add",u.sizes.small).then((e=>{this.icons.add=e}))),t.push(u.getIcon("actions-edit-pick-date",u.sizes.small).then((e=>{this.icons.date=e}))),t.push(u.getIcon("actions-open",u.sizes.small).then((e=>{this.icons.edit=e}))),t.push(u.getIcon("actions-save",u.sizes.small).then((e=>{this.icons.save=e}))),t.push(u.getIcon("actions-close",u.sizes.small).then((e=>{this.icons.close=e}))),t.push(u.getIcon("spinner-circle-dark",u.sizes.small).then((e=>{this.icons.spinner=e}))),Promise.all(t).then((()=>{this.loaded=!0,this.migrationsDone&&f.info(this.language.migrationsPerformedTitle,this.language.migrationsPerformedMessage,0,[{label:this.language.updateMaskDefinition,action:new y((()=>new c(TYPO3.settings.ajaxUrls.mask_persist_definition).get().then((async e=>{const t=await e.resolve();"ok"===t.status&&f.success(t.title,t.message),"error"===t.status&&f.error(t.title,t.message)}))))}])})),10===this.global.typo3Version&&$(document).on("formengine.dp.change",(()=>{document.querySelectorAll(".t3js-datetimepicker").forEach((e=>{e.dispatchEvent(new Event("input"))}))}))}))},save:function(){if(this.saving=!0,this.validate(),this.hasErrors)this.saving=!1,m.confirm(this.language.alert||"Alert",this.language.fieldsMissing,g.error,[{text:this.language.ok||"OK",btnClass:"btn-default",active:!0,name:"ok",trigger:()=>{m.dismiss(),this.getErrorFields().every((e=>!(e.length>0)||(this.global.activeField=e[0],!1)))}}]);else{this.global.deletedFields=[];const e={element:this.getPostElement(),fields:JSON.stringify(this.getPostFields(this.fields)),type:this.type,isNew:"new"===this.mode?1:0};new c(TYPO3.settings.ajaxUrls.mask_save).post(e).then((async t=>{const s=await t.resolve();this.mode="edit",this.showMessages(s.messages),s.hasError||(this.loadElements(),new c(TYPO3.settings.ajaxUrls.mask_load_element).withQueryArguments({type:e.type,key:e.element.key}).get().then((async e=>{const t=await e.resolve();this.fields=t.fields,this.addParentReferenceToFields({},this.fields),this.isEmptyObject(this.global.activeField)||this.findActiveField(this.global.activeField,this.fields),this.saving=!1})))}))}},getPostElement(){if("tt_content"===this.type){const e={key:this.element.key,icon:this.$refs.iconPicker.iconPicker.currentIcon,label:this.element.label,shortLabel:this.element.shortLabel,description:this.element.description,color:this.element.color,colorOverlay:this.element.colorOverlay,hidden:this.element.hidden,sorting:this.element.sorting,saveAndClose:this.element.saveAndClose};return this.global.typo3Version>10&&(e.iconOverlay=this.$refs.iconOverlayPicker.iconPicker.currentIcon),e}return{key:this.element.key}},getPostFields:function(e){const t=[];return e.forEach((e=>{t.push({key:e.key,label:e.label,description:e.description,name:e.name,tca:Object.assign({},e.tca),fields:this.getPostFields(e.fields),sql:e.sql})})),t},closeEdit:function(){this.resetState(),this.loadElements(),this.mode="list"},findActiveField:function(e,t){let s=!1;t.forEach((t=>{t.key===e.key&&(this.isEmptyObject(e.parent)&&this.isEmptyObject(t.parent)||e.parent.key===t.parent.key)&&(this.global.activeField=t,s=!0),s||this.findActiveField(e,t.fields)}))},loadElements:function(){return new c(TYPO3.settings.ajaxUrls.mask_elements).get().then((async e=>{const t=await e.resolve();this.elements=t.elements}))},loadField:function(){this.canHaveMultiUsage(this.global.activeField)&&(new c(TYPO3.settings.ajaxUrls.mask_load_field).withQueryArguments({key:this.global.activeField.key,type:this.type}).get().then((async e=>{const t=await e.resolve();this.global.activeField.tca=t.field.tca,this.global.activeField.label=t.field.label,this.global.activeField.description=t.field.description,this.global.activeField.sql=t.field.sql})),this.loadMultiUse())},loadMultiUse:function(){this.canHaveMultiUsage(this.global.activeField)&&(this.multiUseElements[this.global.activeField.key]||new c(TYPO3.settings.ajaxUrls.mask_multiuse).withQueryArguments({key:this.global.activeField.key,elementKey:this.element.key,newField:this.global.activeField.newField?1:0}).get().then((async e=>{const t=await e.resolve();this.$set(this.multiUseElements,this.global.activeField.key,t.multiUseElements)})))},loadTables:function(){return new c(TYPO3.settings.ajaxUrls.mask_tables).get().then((async e=>{const t=await e.resolve();this.global.foreignTables=t.foreignTables}))},validateKey:function(e){if(this.isEmptyObject(this.global.activeField))return!1;if(!this.isActiveCoreField&&!this.hasMaskPrefix(e.key))return e.key=this.global.maskPrefix,!1;if(e.key=this.checkAllowedCharacters(e.key),e.key===this.global.maskPrefix)return!1;let t=this.getFields(e),s=this.checkIfKeyExistsInFields(t,this.global.activeField);if(s?this.fieldErrors.existingFieldKeyFields.push(this.global.activeField):this.removeExistingKeyField(this.global.activeField),this.fieldErrors.existingFieldKeyFields.every((t=>(t===e||this.checkIfKeyExistsInFields(this.getFields(t),t)||this.removeExistingKeyField(t),!0))),this.isRoot(e)&&this.getAvailableTcaKeys()[e.name].includes(e.key))return!1;if(s)return!1;if(!e.newField)return!0;if(!this.isRoot(e)&&"inline"!==e.name&&"content"!==e.name)return!0;let i={table:this.type,key:e.key,type:e.name,elementKey:""};return"edit"===this.mode&&(i.elementKey=this.element.key),new c(TYPO3.settings.ajaxUrls.mask_check_field_key).withQueryArguments(i).get().then((async e=>(await e.resolve()).isAvailable?(this.removeExistingKeyField(this.global.activeField),!0):(this.fieldErrors.existingFieldKeyFields.push(this.global.activeField),!1)))},hasMaskPrefix:function(e){return e.substr(0,this.global.maskPrefix.length)===this.global.maskPrefix},isRoot:function(e){return this.isEmptyObject(e.parent)||"palette"===e.parent.name&&this.isEmptyObject(e.parent.parent)},canHaveMultiUsage(e){return this.canBeShared(e)&&this.isRoot(e)&&this.isExistingMaskField(e)},canBeShared:function(e){return!this.global.nonShareableFields.includes(e.name)},getFields:function(e){let t=this.fields;return this.isRoot(e)||(t="palette"===e.parent.name&&this.isEmptyObject(e.parent.parent)?e.parent.parent.fields:e.parent.fields),t},checkIfKeyExistsInFields:function(e,t){let s=!1;return e.every((e=>e===t||(t.key===e.key?s=!0:s||"palette"!==e.name||(s=this.checkIfKeyExistsInFields(e.fields,t)),!s))),s},removeExistingKeyField:function(e){this.fieldErrors.existingFieldKeyFields=this.fieldErrors.existingFieldKeyFields.filter((t=>t!==e))},openNew:function(){this.resetState(),this.type="tt_content",this.element=this.getNewElement();const e=[null,null];this.isTYPO3v11&&(e[0]=this.language.multistep.chooseLabel,e[1]=this.language.multistep.chooseKey),p.addSlide("new-mask-element-step-1",this.language.multistep.chooseLabel,"",g.info,e[0],(e=>{p.blurCancelStep(),p.lockPrevStep();let t="";t+="<p>"+this.language.multistep.text1+"</p>",t+='<label class="control-label" for="mask-step-label">'+this.language.elementLabel+"</label>",t+='<input id="mask-step-label" class="form-control" placeholder="'+this.language.multistep.placeholder1+'"/>',e.html(t);const s=p.setup.$carousel.closest(".modal").find("#mask-step-label");s.focus(),p.set("elementLabel",""),s.on("change",(function(){p.set("elementLabel",$(this).val())})),s.on("keyup",(e=>{"Enter"===e.originalEvent.code&&p.triggerStepButton("next")}))})),p.addSlide("new-mask-element-step-2",this.language.multistep.chooseKey,"",g.info,e[1],(e=>{this.isTYPO3v11&&p.unlockPrevStep();let t="";t+="<p>"+this.language.multistep.text2+"</p>",t+='<label class="control-label" for="mask-step-key">'+this.language.elementKey+"</label>",t+='<input id="mask-step-key" class="form-control" placeholder="'+this.language.multistep.placeholder2+'"/>',e.html(t);const s=p.setup.$carousel.closest(".modal").find("#mask-step-key");s.val(this.checkAllowedCharacters(p.setup.settings.elementLabel)),p.set("elementKey",s.val()),s.on("change",(function(){p.set("elementKey",$(this).val())})),s.on("keyup",(e=>{"Enter"===e.originalEvent.code&&p.triggerStepButton("next")})),p.setup.$carousel.closest(".modal").find(".modal-footer").find('button[name="next"]').focus()})),p.addFinalProcessingSlide((()=>{this.element.label=p.setup.settings.elementLabel,this.element.key=p.setup.settings.elementKey,this.loaded=!1,this.mode="new",this.validate(),Promise.resolve(this.loadTca()).then((()=>{this.loaded=!0,p.dismiss()}))})).then((()=>{p.show(),this.isTYPO3v11&&(p.setup.forceSelection=!1)}))},openEdit:function(e,t){this.loaded=!1,this.mode="edit",this.type=e,this.element=t,this.searchString="";let s=[];s.push(this.loadTca().then((()=>{new c(TYPO3.settings.ajaxUrls.mask_load_element).withQueryArguments({type:e,key:t.key}).get().then((async e=>{const t=await e.resolve();this.fields=t.fields,this.updateParents()}))}))),s.push(new c(TYPO3.settings.ajaxUrls.mask_all_multiuse).withQueryArguments({table:this.type,elementKey:t.key}).get().then((async e=>{const t=await e.resolve();0!==t.multiUseElements.length&&(this.multiUseElements=t.multiUseElements)}))),Promise.all(s).then((()=>{this.loaded=!0}))},updateParents:function(){this.addParentReferenceToFields({},this.fields)},addParentReferenceToFields:function(e,t){t.forEach((t=>{t.parent=e,this.addParentReferenceToFields(t,t.fields)}))},loadTca:function(){return new c(TYPO3.settings.ajaxUrls.mask_fieldtypes).get().then((async e=>{this.fieldTypes=await e.resolve(),this.fieldTypes.forEach((e=>{new c(TYPO3.settings.ajaxUrls.mask_existing_tca).withQueryArguments({table:this.type,type:e.name}).get().then((async t=>{this.availableTca[e.name]=await t.resolve()}))}))}))},deleteElement:function(e,t){new c(TYPO3.settings.ajaxUrls.mask_delete).post({key:e.key,purge:t}).then((async e=>{const t=await e.resolve();this.showMessages(t),this.loadElements()}))},openDeleteDialog(e){m.confirm(this.language.deleteModal.title+": "+e.label,this.language.deleteModal.content,g.warning,[{text:this.language.deleteModal.close,btnClass:"btn-default",trigger:function(){m.dismiss()}},{text:this.language.deleteModal.delete,active:!0,btnClass:"btn-warning",trigger:()=>{m.dismiss(),this.deleteElement(e,0)}},{text:this.language.deleteModal.purge,btnClass:"btn-danger",trigger:()=>{m.dismiss(),this.deleteElement(e,1)}}])},showMissingFilesOrFolder(){let e="";if(!Array.isArray(this.missingFilesOrFolders.missingFolders)){e+=this.language.missingFolders+":\n";for(const[t,s]of Object.entries(this.missingFilesOrFolders.missingFolders))e+=`${s} (${t})\n`}if(!Array.isArray(this.missingFilesOrFolders.missingTemplates)){""!==e&&(e+="\n"),e+=this.language.missingTemplates+":\n";for(const[t,s]of Object.entries(this.missingFilesOrFolders.missingTemplates))e+=`${s} (${t}) \n`}m.confirm(this.language.createMissingFilesOrFolders,e,g.info,[{text:this.language.close,btnClass:"btn btn-default",trigger:()=>{m.dismiss()}},{text:this.language.create,btnClass:"btn btn-info",trigger:()=>{m.dismiss(),this.fixMissing()}}])},fixMissing(e=!0){new c(TYPO3.settings.ajaxUrls.mask_fix_missing).get().then((async t=>{const s=await t.resolve();e&&this.showMessages(s.messages),new c(TYPO3.settings.ajaxUrls.mask_missing).get().then((async e=>{this.missingFilesOrFolders=await e.resolve(),this.loadElements()}))}))},showMessages:function(e){Object.keys(e).forEach((t=>{const s=e[t];0===s.severity?f.success(s.title,s.message):1===s.severity?f.warning(s.title,s.message):f.error(s.title,s.message)}))},resetState:function(){this.type="",this.element={},this.fields=[],this.sidebar="fields",this.multiUseElements={},this.global.deletedFields=[],this.global.activeField={},this.global.clonedField={},this.fieldErrors={elementKeyAvailable:!0,elementKey:!1,elementLabel:!1,emptyKeyFields:[],emptyTabLabels:[],emptyGroupAllowedFields:[],emptyRadioItems:[],existingFieldKeyFields:[]}},fieldHasError:function(e){return!!this.hasFieldErrors&&(!!this.fieldErrors.emptyKeyFields.includes(e)||(!!this.fieldErrors.emptyTabLabels.includes(e)||(!!this.fieldErrors.existingFieldKeyFields.includes(e)||(!!this.fieldErrors.emptyGroupAllowedFields.includes(e)||!!this.fieldErrors.emptyRadioItems.includes(e)))))},validate:function(){this.fieldErrors.elementKey=""===this.element.key,this.fieldErrors.elementLabel=""===this.element.label,this.fieldErrors.emptyKeyFields=[],this.fieldErrors.emptyTabLabels=[],this.fieldErrors.emptyGroupAllowedFields=[],this.fieldErrors.emptyRadioItems=[],this.checkFieldKeyIsEmpty(this.fields),this.checkTabLabelIsEmpty(this.fields),this.checkEmptyGroupAllowed(this.fields),this.checkEmptyRadioItems(this.fields)},getErrorFields:function(){return[this.fieldErrors.emptyKeyFields,this.fieldErrors.emptyTabLabels,this.fieldErrors.emptyGroupAllowedFields,this.fieldErrors.emptyRadioItems]},checkFieldKeyIsEmpty:function(e){e.every((e=>(e.key===this.global.maskPrefix&&this.fieldErrors.emptyKeyFields.push(e),e.fields.length>0&&this.checkFieldKeyIsEmpty(e.fields),!0)))},checkTabLabelIsEmpty:function(e){e.every((e=>("tab"===e.name&&""===e.label&&this.fieldErrors.emptyTabLabels.push(e),e.fields.length>0&&this.checkTabLabelIsEmpty(e.fields),!0)))},checkEmptyGroupAllowed:function(e){e.every((e=>(this.isCoreField(e)||("db"===e.tca["config.internal_type"]&&""===e.tca["config.allowed"]&&this.fieldErrors.emptyGroupAllowedFields.push(e),e.fields.length>0&&this.checkEmptyGroupAllowed(e.fields)),!0)))},checkEmptyRadioItems:function(e){e.every((e=>{if(this.isCoreField(e))return!0;if("radio"===e.name){const t=e.tca["config.items"];0===t.length?this.fieldErrors.emptyRadioItems.push(e):t.every((t=>!!this.isNumeric(t[1])||(this.fieldErrors.emptyRadioItems.push(e),!1)))}return e.fields.length>0&&this.checkEmptyRadioItems(e.fields),!0}))},handleClone:function(e){let t=JSON.parse(JSON.stringify(e));return this.$delete(t,"uid"),this.global.clonedField=t,t},addField:function(e){const t=this.handleClone(e),s=this.global.activeField.parent;let i="",l="",n=this.fields;if(void 0===s||0===s.length?t.parent={}:(l=s.name,i=s.key,t.parent=s,void 0!==s.fields&&(n=s.fields)),this.validateMove(i,l,t)){const e=n.indexOf(this.global.activeField)+1;n.splice(e,0,t),this.global.activeField=t,this.global.currentTab="general",this.validateKey(t)}},onMove:function(e){const t=e.draggedContext.element;let s=e.relatedContext.component.$parent;const i=s.depth,l=s.index;let n="",a="";return i>0&&(n=s.$parent.list[l].name,a=s.$parent.list[l].key),this.validateMove(a,n,t)},onSort:function(){this.updateParents()},validateMove:function(e,t,s){if("palette"===t&&["palette","tab"].includes(s.name))return!1;if("linebreak"===s.name&&"palette"!==t)return!1;if(s.newField&&!this.isCoreField(s))return!0;let i=new Set,l=s.parent;for(;;){if("inline"===l.name){i=this.getAllowedFields(l.key,l.fields);break}if(void 0===l.name){i=this.getAllowedFields("",this.fields);break}l=l.parent}return i.has(e)},getAllowedFields:function(e,t){const s=new Set;return s.add(e),new Set([...s,...this.getPaletteKeysOfField(t)])},getPaletteKeysOfField:function(e,t=[]){for(let s of e)"palette"===s.name&&t.push(s.key);return t},getNewElement:function(){return{key:"",label:"",shortLabel:"",description:"",icon:"",color:"#000000",iconOverlay:"",colorOverlay:"#000000",saveAndClose:0}},isParentField:function(e){return["palette","inline"].includes(e.name)},resetActiveField:function(){this.global.activeField.tca=Object.assign({},this.defaultTca[this.global.activeField.name]),f.success("",this.language.reset)},isEmptyObject:function(e){return 0===Object.keys(e).length&&e.constructor===Object},isNumeric:function(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))},checkAllowedCharacters:function(e){return e=(e=(e=e.toLowerCase()).replace(/\s/g,"_")).replace(/[^a-z0-9_]/g,"")},isCoreField:function(e){if(this.isEmptyObject(e))return!1;let t=!1;return this.availableTca[e.name].core.forEach((s=>{s.field===e.key&&(t=!0)})),t},isExistingMaskField:function(e){if(this.isEmptyObject(this.global.activeField))return!1;let t=!1;return this.availableTca[e.name].mask.forEach((function(s){s.field===e.key&&(t=!0)})),t},availableTcaForField:function(e,t){return this.isEmptyObject(this.availableTca)||this.isEmptyObject(t)?[]:this.availableTca[t.name][e].filter((e=>!this.currentFieldKeys.includes(e.field)&&!this.deletedFieldKeys.includes(e.field)||t.key===e.field))},getFieldKeys:function(e){const t=[];return e.forEach((function(e){"palette"===e.name&&e.fields.forEach((function(e){e.newField||t.push(e.key)})),e.newField||t.push(e.key)})),t},getAvailableTcaKeys:function(){const e={};return Object.keys(this.availableTca).forEach((t=>{e[t]=[],this.availableTca[t].core.forEach((s=>{e[t].push(s.field)})),this.availableTca[t].mask.forEach((s=>{e[t].push(s.field)}))})),e},openMultiUsageModal(){let e="";this.activeMultiUseElements.forEach(((t,s)=>{e+=`${s+1}: ${t.label} (${t.key})\n`})),m.confirm("Content elements with same field",e,g.info,[{text:this.language.close,btnClass:"btn-default",trigger:()=>{m.dismiss()}}])},submitAutoConfiguration(){new c(TYPO3.settings.ajaxUrls.mask_setup_autoconfigure).post(this.setupConfiguration).then((async e=>{const t=await e.resolve();this.setupConfiguration.error=t.result.error,""===this.setupConfiguration.error&&(f.success("","Successfully auto-configured Mask for "+this.setupConfiguration.extension+"!"),this.fixMissing(!1),this.init())}))},forceRenderer(){this.ticks+=1},keyWithoutMask:function(e){return e.substr(0,8)===this.global.maskPrefix?e.substr(8):e}},computed:{hasErrors:function(){return this.hasElementErrors||this.hasFieldErrors},hasElementErrors:function(){return this.fieldErrors.elementKey||this.fieldErrors.elementLabel||!this.fieldErrors.elementKeyAvailable},hasFieldErrors:function(){return this.fieldErrors.emptyKeyFields.length>0||this.fieldErrors.emptyTabLabels.length>0||this.fieldErrors.emptyGroupAllowedFields.length>0||this.fieldErrors.emptyRadioItems.length>0||this.fieldErrors.existingFieldKeyFields.length>0},maskBuilderOpen:function(){return"edit"===this.mode||"new"===this.mode},isActiveCoreField:function(){return this.isCoreField(this.global.activeField)},fieldTabs:function(){return this.global.activeField.name?this.tabs[this.global.activeField.name]:[]},chooseFieldVisible:function(){return!this.isEmptyObject(this.global.activeField)&&(!(!this.global.activeField.newField&&!this.isActiveCoreField)&&(!!this.canBeShared(this.global.activeField)&&(!!this.isRoot(this.global.activeField)&&(this.availableCoreTcaForActiveField.length>0||this.availableMaskTcaForActiveField.length>0))))},filteredElements(){return""===this.lowerCaseSearchString?Object.values(this.elements):Object.values(this.elements).filter((e=>e.label.toLowerCase().includes(this.lowerCaseSearchString)||e.shortLabel.toLowerCase().includes(this.lowerCaseSearchString)||e.description.toLowerCase().includes(this.lowerCaseSearchString)||e.key.includes(this.lowerCaseSearchString)))},lowerCaseSearchString(){return this.searchString.toLowerCase()},keyFieldVisible:function(){return!this.global.sctructuralFields.includes(this.global.activeField.name)&&this.maskFieldGeneralTabOpen},maskFieldGeneralTabOpen:function(){return this.isGeneralTabOpen&&!this.isActiveCoreField},overrideLabelVisible:function(){return this.isGeneralTabOpen&&this.isActiveCoreField},overrideDescriptionVisible:function(){return this.isGeneralTabOpen&&this.isActiveCoreField},isGeneralTabOpen:function(){return"general"===this.global.currentTab},availableCoreTcaForActiveField:function(){return this.availableTcaForField("core",this.global.activeField)},availableMaskTcaForActiveField:function(){return this.availableTcaForField("mask",this.global.activeField)},activeFieldHasKeyError:function(){return this.fieldErrors.emptyKeyFields.includes(this.global.activeField)||this.fieldErrors.existingFieldKeyFields.includes(this.global.activeField)},activeTabHasEmptyLabel:function(){return this.fieldErrors.emptyTabLabels.includes(this.global.activeField)},currentFieldKeys:function(){return this.getFieldKeys(this.fields)},deletedFieldKeys:function(){return this.getFieldKeys(this.global.deletedFields)},defaultTca:function(){if(this.isEmptyObject(this.fieldTypes))return[];const e={};return this.fieldTypes.forEach((t=>{e[t.name]=t.tca})),e},activeMultiUseElements:function(){return this.isRoot(this.global.activeField)&&void 0!==this.multiUseElements[this.global.activeField.key]?this.multiUseElements[this.global.activeField.key]:[]},metaVisible:function(){return"meta"===this.sidebar},fieldsVisible:function(){return"fields"===this.sidebar},isTYPO3v11:function(){return 11===this.global.typo3Version}}})}))}));
